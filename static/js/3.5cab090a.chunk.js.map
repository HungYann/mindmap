{"version":3,"sources":["methods/mindmapExporter.js","components/Popup/subComponents/Export.js"],"names":["copyNodeData","format","target_node","source_node","data","id","created","Date","now","text","expandState","showChildren","children","map","child","mindmap","export_data","lines","dfs","node","layer","push","repeat","exportNodeToText","forEach","join","exportMindmapToText","km_mindmap","root","JSON","stringify","exportMindmapToJSON","Export","handleClosePopup","useContext","context","state","title","global","clearNodeStatus","useMindmap","handleExportText","mindmapExporter","url","encodeURIComponent","downloadFile","toLowerCase","className","list_wrapper","onClick","html2canvas","document","getElementById","refer","then","canvas","toDataURL","css"],"mappings":"uLA6BMA,EAAe,SAAfA,EAAgBC,EAAQC,EAAaC,GACvC,OAAQF,GACJ,IAAK,KAOD,OANAC,EAAYE,KAAO,GACnBF,EAAYE,KAAKC,GAAKF,EAAYE,GAClCH,EAAYE,KAAKE,QAAUC,KAAKC,MAChCN,EAAYE,KAAKK,KAAON,EAAYM,KACpCP,EAAYE,KAAKM,YAAcP,EAAYQ,aAAe,SAAW,WACrET,EAAYU,SAAWT,EAAYS,SAASC,KAAI,SAAAC,GAAK,OAAId,EAAaC,EAAQ,GAAIa,MAC3EZ,EACX,QACI,SAcG,WAACa,EAASd,GACrB,IAAIe,EACJ,OAAQf,GACJ,IAAK,KACL,IAAK,MACDe,EA7CgB,SAACD,EAASd,GAClC,IAAIgB,EAAQ,GAWZ,OAVY,SAANC,EAAOC,EAAMC,EAAOnB,GACjBkB,IAGLF,EAAMI,KApBW,SAACF,EAAMC,EAAOnB,GACnC,OAAQA,GACJ,IAAK,KACD,OAAImB,EAAQ,EACD,IAAIE,OAAOF,EAAQ,GAAK,IAAMD,EAAKV,KAEvC,KAAKa,OAAOF,EAAQ,GAAK,KAAOD,EAAKV,KAChD,IAAK,MACD,MAAO,KAAKa,OAAOF,GAASD,EAAKV,KACrC,QACI,QAUOc,CAAiBJ,EAAMC,EAAOnB,IACzCkB,EAAKP,SAASY,SAAQ,SAAAV,GAClBI,EAAIJ,EAAOM,EAAQ,EAAGnB,OAG9BiB,CAAIH,EAAS,EAAGd,GACTgB,EAAMQ,KAAK,MAiCIC,CAAoBX,EAASd,GAC3C,MACJ,QACIe,EAlBgB,SAACD,EAASd,GAClC,OAAQA,GACJ,IAAK,KACD,IAAM0B,EAAa,CAACC,KAAM5B,EAAaC,EAAQ,GAAIc,IACnD,OAAOc,KAAKC,UAAUH,GAC1B,QACI,QAYcI,CAAoBhB,EAASd,GAGnD,OAAOe,G,sZCvBIgB,UAhCA,SAAC,GAAwB,IAAvBC,EAAsB,EAAtBA,iBAAsB,EAC2BC,qBAAWC,KAAjDpB,EADW,EAC5BA,QAAUqB,MAAkCC,EADhB,EACDC,OAASF,MAAQC,MAC5CE,EAAmBC,cAAnBD,gBAUDE,EAAmB,SAAAxC,GACrB,IAAMG,EAAOsC,EAAgB3B,EAASd,GAClC0C,EAAG,0BAAsBC,mBAAmBxC,IAChDyC,YAAaF,EAAD,UAASN,EAAT,YAAkBpC,EAAO6C,iBAGzC,OAAQ,6BACJ,kBAAC,IAAD,yDACA,wBAAIC,UAAWC,GACX,wBAAIC,QAjBY,WACpBV,IACAW,IAAYC,SAASC,eAAeC,MAAmBC,MAAK,SAAAC,GACxD,IAAIZ,EAAMY,EAAOC,UAAU,aAC3BX,YAAaF,EAAD,UAASN,EAAT,cAakB,uBAAGU,UAAW,sBAA5C,oCACA,wBAAIE,QAAS,WAAQR,EAAiB,QAAU,uBAAGM,UAAW,oBAA9D,2CACA,wBAAIE,QAAS,WAAQR,EAAiB,QAAU,uBAAGM,UAAW,sBAA9D,2BACA,wBAAIE,QAAS,WAAQR,EAAiB,SAAW,uBAAGM,UAAW,qBAA/D,6CAEJ,kBAAC,IAAD,KACI,4BAAQE,QAAShB,GAAjB,mBA3BZ,IAmCMe,EAAeS,YAAH,IAiBWJ","file":"static/js/3.5cab090a.chunk.js","sourcesContent":["const exportNodeToText = (node, layer, format) => {\n    switch (format) {\n        case 'MD':\n            if (layer < 6) {\n                return '#'.repeat(layer + 1) + ' ' + node.text;\n            }\n            return '\\t'.repeat(layer - 6) + '- ' + node.text;\n        case 'TXT':\n            return '\\t'.repeat(layer) + node.text;\n        default:\n            return;\n    }\n};\n\nconst exportMindmapToText = (mindmap, format) => {\n    let lines = [];\n    const dfs = (node, layer, format) => {\n        if (!node) {\n            return;\n        }\n        lines.push(exportNodeToText(node, layer, format));\n        node.children.forEach(child => {\n            dfs(child, layer + 1, format)\n        });\n    };\n    dfs(mindmap, 0, format);\n    return lines.join('\\n');\n};\n\nconst copyNodeData = (format, target_node, source_node) => {\n    switch (format) {\n        case 'KM':\n            target_node.data = {};\n            target_node.data.id = source_node.id;\n            target_node.data.created = Date.now();\n            target_node.data.text = source_node.text;\n            target_node.data.expandState = source_node.showChildren ? 'expand' : 'collapse';\n            target_node.children = source_node.children.map(child => copyNodeData(format, {}, child));\n            return target_node;\n        default:\n            return;\n    }\n};\n\nconst exportMindmapToJSON = (mindmap, format) => {\n    switch (format) {\n        case 'KM':\n            const km_mindmap = {root: copyNodeData(format, {}, mindmap)};\n            return JSON.stringify(km_mindmap);\n        default:\n            return;\n    }\n};\n\nexport default (mindmap, format) => {\n    let export_data;\n    switch (format) {\n        case 'MD':\n        case 'TXT':\n            export_data = exportMindmapToText(mindmap, format);\n            break;\n        default:\n            export_data = exportMindmapToJSON(mindmap, format);\n            break;\n    }\n    return export_data;\n}\n","import React, {useContext} from 'react';\nimport {css} from 'emotion';\nimport {context} from '../../../context';\nimport useMindmap from '../../../customHooks/useMindmap';\nimport * as refer from '../../../statics/refer';\nimport html2canvas from 'html2canvas';\nimport {downloadFile} from '../../../methods/assistFunctions';\nimport mindmapExporter from '../../../methods/mindmapExporter';\nimport {Highlight, ButtonSet} from '../common/styledComponents';\n\nconst Export = ({handleClosePopup}) => {\n    const {mindmap: {state: mindmap}, global: {state: {title}}} = useContext(context);\n    const {clearNodeStatus} = useMindmap();\n\n    const handleExportPNG = () => {\n        clearNodeStatus(); // 防止选中状态时的工具条等也被导出到图像\n        html2canvas(document.getElementById(refer.MINDMAP_ID)).then(canvas => {\n            let url = canvas.toDataURL('image/png');\n            downloadFile(url, `${title}.png`);\n        });\n    };\n\n    const handleExportText = format => {\n        const data = mindmapExporter(mindmap, format);\n        let url = `data:text/plain,${encodeURIComponent(data)}`;\n        downloadFile(url, `${title}.${format.toLowerCase()}`);\n    };\n\n    return (<div>\n        <Highlight>请选择导出格式：</Highlight>\n        <ul className={list_wrapper}>\n            <li onClick={handleExportPNG}><i className={'zwicon-file-image'} />PNG 图片（.png）</li>\n            <li onClick={() => { handleExportText('KM'); }}><i className={'zwicon-file-pdf'} />百度脑图（.km）</li>\n            <li onClick={() => { handleExportText('MD'); }}><i className={'zwicon-file-table'} />Markdown（.md）</li>\n            <li onClick={() => { handleExportText('TXT'); }}><i className={'zwicon-file-font'} />文本文件（.txt）</li>\n        </ul>\n        <ButtonSet>\n            <button onClick={handleClosePopup}>完成</button>\n        </ButtonSet>\n    </div>);\n};\n\nexport default Export;\n\n// CSS\nconst list_wrapper = css`\npadding: 0;\nlist-style: none;\n\nli {\npadding: 5px 0 5px 5px;\nborder-left: 3px solid transparent;\nborder-bottom: 1px solid #dddddd;\nline-height: 30px;\ncursor: pointer;\n}\n\nli:last-of-type {\nborder-bottom: none;\n}\n\nli:hover {\nborder-left: 3px solid var(${refer.THEME_EX});\n}\n\nli i {\nmargin-right: 10px;\nfont-size: 30px;\n}\n`;"],"sourceRoot":""}