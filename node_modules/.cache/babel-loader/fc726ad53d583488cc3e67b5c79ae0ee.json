{"ast":null,"code":"import _taggedTemplateLiteral from\"/Users/liuhongyang/Documents/GitHub/repositories/mindmap/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";import _slicedToArray from\"/Users/liuhongyang/Documents/GitHub/repositories/mindmap/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";function _templateObject(){var data=_taggedTemplateLiteral([\"\\nposition: absolute;\\ntop:0;\\nleft:0;\\nz-index: -2;\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useState,useEffect,useRef,useContext}from'react';import{css}from'emotion';import useTheme from'../../customHooks/useTheme';import{context}from'../../context';import{drawLineCanvas}from'../../methods/drawCanvas';var LineCanvas=function LineCanvas(_ref){var parent_ref=_ref.parent_ref,mindmap=_ref.mindmap,node_refs=_ref.node_refs;var self=useRef();var _useState=useState(0),_useState2=_slicedToArray(_useState,2),flag=_useState2[0],setFlag=_useState2[1];var _useTheme=useTheme(),theme=_useTheme.theme;var _useContext=useContext(context),gState=_useContext.global.state;var handleWindowResize=function handleWindowResize(e){setFlag(Date.now());};useEffect(function(){window.addEventListener('resize',handleWindowResize);return function(){window.removeEventListener('resize',handleWindowResize);};},[]);useEffect(function(){var dom=self.current;dom.width=parent_ref.current.offsetWidth;dom.height=parent_ref.current.offsetHeight;// 重新设置 canvas 大小，也兼具清除画板的作用\nvar map=new Map(Array.from(node_refs).map(function(ref){return[ref.current.id,[ref.current.offsetLeft,ref.current.offsetLeft+ref.current.offsetWidth,ref.current.offsetTop+0.5*ref.current.offsetHeight,ref.current.dataset.tag]];}));var ctx=dom.getContext('2d');drawLineCanvas(ctx,theme,mindmap,map);},[mindmap,theme,flag,gState.zoom]);return/*#__PURE__*/React.createElement(\"canvas\",{ref:self,className:wrapper});};export default LineCanvas;// CSS\nvar wrapper=css(_templateObject());","map":{"version":3,"sources":["/Users/liuhongyang/Documents/GitHub/repositories/mindmap/src/components/LineCanvas/index.js"],"names":["React","useState","useEffect","useRef","useContext","css","useTheme","context","drawLineCanvas","LineCanvas","parent_ref","mindmap","node_refs","self","flag","setFlag","theme","gState","global","state","handleWindowResize","e","Date","now","window","addEventListener","removeEventListener","dom","current","width","offsetWidth","height","offsetHeight","map","Map","Array","from","ref","id","offsetLeft","offsetTop","dataset","tag","ctx","getContext","zoom","wrapper"],"mappings":"2iBAAA,MAAOA,CAAAA,KAAP,EAAeC,QAAf,CAAyBC,SAAzB,CAAoCC,MAApC,CAA4CC,UAA5C,KAA6D,OAA7D,CACA,OAAQC,GAAR,KAAkB,SAAlB,CACA,MAAOC,CAAAA,QAAP,KAAqB,4BAArB,CACA,OAAQC,OAAR,KAAsB,eAAtB,CACA,OAAQC,cAAR,KAA6B,0BAA7B,CAEA,GAAMC,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,MAAsC,IAApCC,CAAAA,UAAoC,MAApCA,UAAoC,CAAxBC,OAAwB,MAAxBA,OAAwB,CAAfC,SAAe,MAAfA,SAAe,CACrD,GAAMC,CAAAA,IAAI,CAAGV,MAAM,EAAnB,CADqD,cAE7BF,QAAQ,CAAC,CAAD,CAFqB,wCAE9Ca,IAF8C,eAExCC,OAFwC,6BAIrCT,QAAQ,EAJ6B,CAI9CU,KAJ8C,WAI9CA,KAJ8C,iBAKvBZ,UAAU,CAACG,OAAD,CALa,CAKhCU,MALgC,aAK9CC,MAL8C,CAKtCC,KALsC,CAOrD,GAAMC,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAACC,CAAD,CAAO,CAC9BN,OAAO,CAACO,IAAI,CAACC,GAAL,EAAD,CAAP,CACH,CAFD,CAIArB,SAAS,CAAC,UAAM,CACZsB,MAAM,CAACC,gBAAP,CAAwB,QAAxB,CAAkCL,kBAAlC,EACA,MAAO,WAAM,CACTI,MAAM,CAACE,mBAAP,CAA2B,QAA3B,CAAqCN,kBAArC,EACH,CAFD,CAGH,CALQ,CAKN,EALM,CAAT,CAOAlB,SAAS,CAAC,UAAM,CACZ,GAAMyB,CAAAA,GAAG,CAAGd,IAAI,CAACe,OAAjB,CACAD,GAAG,CAACE,KAAJ,CAAYnB,UAAU,CAACkB,OAAX,CAAmBE,WAA/B,CACAH,GAAG,CAACI,MAAJ,CAAarB,UAAU,CAACkB,OAAX,CAAmBI,YAAhC,CAA8C;AAC9C,GAAMC,CAAAA,GAAG,CAAG,GAAIC,CAAAA,GAAJ,CAAQC,KAAK,CAACC,IAAN,CAAWxB,SAAX,EAAsBqB,GAAtB,CAA0B,SAAAI,GAAG,QAAI,CAACA,GAAG,CAACT,OAAJ,CAAYU,EAAb,CAAiB,CAAED,GAAG,CAACT,OAAJ,CAAYW,UAAd,CAA4BF,GAAG,CAACT,OAAJ,CAAYW,UAAZ,CAAyBF,GAAG,CAACT,OAAJ,CAAYE,WAAjE,CAAgFO,GAAG,CAACT,OAAJ,CAAYY,SAAZ,CAAwB,IAAMH,GAAG,CAACT,OAAJ,CAAYI,YAA1H,CAAyIK,GAAG,CAACT,OAAJ,CAAYa,OAAZ,CAAoBC,GAA7J,CAAjB,CAAJ,EAA7B,CAAR,CAAZ,CACA,GAAMC,CAAAA,GAAG,CAAGhB,GAAG,CAACiB,UAAJ,CAAe,IAAf,CAAZ,CACApC,cAAc,CAACmC,GAAD,CAAM3B,KAAN,CAAaL,OAAb,CAAsBsB,GAAtB,CAAd,CACH,CAPQ,CAON,CAACtB,OAAD,CAAUK,KAAV,CAAiBF,IAAjB,CAAuBG,MAAM,CAAC4B,IAA9B,CAPM,CAAT,CASA,mBAAQ,8BAAQ,GAAG,CAAEhC,IAAb,CAAmB,SAAS,CAAEiC,OAA9B,EAAR,CACH,CA5BD,CA8BA,cAAerC,CAAAA,UAAf,CAEA;AACA,GAAMqC,CAAAA,OAAO,CAAGzC,GAAH,mBAAb","sourcesContent":["import React, {useState, useEffect, useRef, useContext} from 'react';\nimport {css} from 'emotion';\nimport useTheme from '../../customHooks/useTheme';\nimport {context} from '../../context'\nimport {drawLineCanvas} from '../../methods/drawCanvas';\n\nconst LineCanvas = ({parent_ref, mindmap, node_refs}) => {\n    const self = useRef();\n    const [flag, setFlag] = useState(0);\n\n    const {theme} = useTheme();\n    const {global:{state:gState}}=useContext(context);\n\n    const handleWindowResize = (e) => {\n        setFlag(Date.now());        \n    };\n\n    useEffect(() => {\n        window.addEventListener('resize', handleWindowResize);\n        return () => {\n            window.removeEventListener('resize', handleWindowResize);\n        }\n    }, []);\n\n    useEffect(() => {\n        const dom = self.current;\n        dom.width = parent_ref.current.offsetWidth;\n        dom.height = parent_ref.current.offsetHeight; // 重新设置 canvas 大小，也兼具清除画板的作用\n        const map = new Map(Array.from(node_refs).map(ref => [ref.current.id, [(ref.current.offsetLeft), (ref.current.offsetLeft + ref.current.offsetWidth), (ref.current.offsetTop + 0.5 * ref.current.offsetHeight), ref.current.dataset.tag]]));\n        const ctx = dom.getContext('2d');\n        drawLineCanvas(ctx, theme, mindmap, map);\n    }, [mindmap, theme, flag, gState.zoom]);\n\n    return (<canvas ref={self} className={wrapper} />);\n};\n\nexport default LineCanvas;\n\n// CSS\nconst wrapper = css`\nposition: absolute;\ntop:0;\nleft:0;\nz-index: -2;\n`;"]},"metadata":{},"sourceType":"module"}