{"ast":null,"code":"import*as refer from'../statics/refer';export default(function(nodeStatus,mindmapHook,historyHook){var addChild=mindmapHook.addChild,addSibling=mindmapHook.addSibling,editNode=mindmapHook.editNode,deleteNode=mindmapHook.deleteNode,toggleChildren=mindmapHook.toggleChildren,selectNode=mindmapHook.selectNode;var handleKeyEventWithNode=function handleKeyEventWithNode(event){switch(event.key.toUpperCase()){case'TAB':addChild(nodeStatus.cur_select);break;case'ENTER':event.preventDefault();// 防止 enter 的点击行为\naddSibling(nodeStatus.cur_select,nodeStatus.cur_node_info.parent.id);break;case'F2':editNode(nodeStatus.cur_select);break;case'BACKSPACE':case'DELETE':deleteNode(nodeStatus.cur_select,nodeStatus.cur_node_info.parent.id);break;case' ':event.preventDefault();// 默认行为会导致画面移动，因此 prevent，下同\ntoggleChildren(nodeStatus.cur_select,!nodeStatus.cur_node_info.showChildren);// Boolean('false') === true\nbreak;case'ARROWLEFT':event.preventDefault();if(nodeStatus.cur_node_info.parent===refer.ROOT_PARENT){if(nodeStatus.cur_node_info.children.length>3){selectNode(nodeStatus.cur_node_info.children[Math.trunc(nodeStatus.cur_node_info.children.length/2)].id);}}else{if(!nodeStatus.cur_node_info.on_left){selectNode(nodeStatus.cur_node_info.parent.id);}else if(nodeStatus.cur_node_info.children.length>0){selectNode(nodeStatus.cur_node_info.children[0].id);}}break;case'ARROWRIGHT':event.preventDefault();if(nodeStatus.cur_node_info.on_left){selectNode(nodeStatus.cur_node_info.parent.id);}else if(nodeStatus.cur_node_info.children.length>0){selectNode(nodeStatus.cur_node_info.children[0].id);}break;case'ARROWUP':{event.preventDefault();var cur_index=nodeStatus.cur_node_info.parent.children.findIndex(function(child){return child.id===nodeStatus.cur_node_info.id;});if(cur_index>0){selectNode(nodeStatus.cur_node_info.parent.children[cur_index-1].id);}break;}case'ARROWDOWN':{event.preventDefault();var _cur_index=nodeStatus.cur_node_info.parent.children.findIndex(function(child){return child.id===nodeStatus.cur_node_info.id;}),last_index=nodeStatus.cur_node_info.parent.children.length-1;if(_cur_index<last_index){selectNode(nodeStatus.cur_node_info.parent.children[_cur_index+1].id);}break;}default:break;}};return function(event){if(nodeStatus.cur_edit===''){var is_on_mac=navigator.platform.toUpperCase().startsWith('MAC');var combine_key_pressed=is_on_mac?event.metaKey:event.ctrlKey;if(combine_key_pressed&&event.key.toUpperCase()==='Z'){if(event.shiftKey){historyHook.redoHistory();}else{historyHook.undoHistory();}}}if(nodeStatus.cur_select!==''){try{handleKeyEventWithNode(event);// 据说在 try 代码块中写大量语句会影响性能，因此包装为函数\n}catch(e){alert('当前的节点信息存在问题，请重新选择节点');}}};});","map":{"version":3,"sources":["/Users/liuhongyang/Documents/GitHub/repositories/mindmap/src/methods/getKeydownEvent.js"],"names":["refer","nodeStatus","mindmapHook","historyHook","addChild","addSibling","editNode","deleteNode","toggleChildren","selectNode","handleKeyEventWithNode","event","key","toUpperCase","cur_select","preventDefault","cur_node_info","parent","id","showChildren","ROOT_PARENT","children","length","Math","trunc","on_left","cur_index","findIndex","child","last_index","cur_edit","is_on_mac","navigator","platform","startsWith","combine_key_pressed","metaKey","ctrlKey","shiftKey","redoHistory","undoHistory","e","alert"],"mappings":"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","sourcesContent":["import * as refer from '../statics/refer';\n\nexport default (nodeStatus, mindmapHook, historyHook) => {\n    const {addChild, addSibling, editNode, deleteNode, toggleChildren, selectNode} = mindmapHook;\n\n    const handleKeyEventWithNode = event => {\n        switch (event.key.toUpperCase()) {\n            case 'TAB':\n                addChild(nodeStatus.cur_select);\n                break;\n            case 'ENTER':\n                event.preventDefault(); // 防止 enter 的点击行为\n                addSibling(nodeStatus.cur_select, nodeStatus.cur_node_info.parent.id);\n                break;\n            case 'F2':\n                editNode(nodeStatus.cur_select);\n                break;\n            case 'BACKSPACE':\n            case 'DELETE':\n                deleteNode(nodeStatus.cur_select, nodeStatus.cur_node_info.parent.id);\n                break;\n            case ' ':\n                event.preventDefault(); // 默认行为会导致画面移动，因此 prevent，下同\n                toggleChildren(nodeStatus.cur_select, !nodeStatus.cur_node_info.showChildren); // Boolean('false') === true\n                break;\n            case 'ARROWLEFT':\n                event.preventDefault();\n                if (nodeStatus.cur_node_info.parent === refer.ROOT_PARENT) {\n                    if (nodeStatus.cur_node_info.children.length > 3) {\n                        selectNode(nodeStatus.cur_node_info.children[Math.trunc(nodeStatus.cur_node_info.children.length / 2)].id);\n                    }\n                } else {\n                    if (!nodeStatus.cur_node_info.on_left) {\n                        selectNode(nodeStatus.cur_node_info.parent.id);\n                    } else if (nodeStatus.cur_node_info.children.length > 0) {\n                        selectNode(nodeStatus.cur_node_info.children[0].id);\n                    }\n                }\n                break;\n            case 'ARROWRIGHT':\n                event.preventDefault();\n                if (nodeStatus.cur_node_info.on_left) {\n                    selectNode(nodeStatus.cur_node_info.parent.id);\n                } else if (nodeStatus.cur_node_info.children.length > 0) {\n                    selectNode(nodeStatus.cur_node_info.children[0].id);\n                }\n                break;\n            case 'ARROWUP': {\n                event.preventDefault();\n                const cur_index = nodeStatus.cur_node_info.parent.children.findIndex(child => child.id === nodeStatus.cur_node_info.id);\n                if (cur_index > 0) {\n                    selectNode(nodeStatus.cur_node_info.parent.children[cur_index - 1].id);\n                }\n                break;\n            }\n            case 'ARROWDOWN': {\n                event.preventDefault();\n                const cur_index = nodeStatus.cur_node_info.parent.children.findIndex(child => child.id === nodeStatus.cur_node_info.id),\n                    last_index = nodeStatus.cur_node_info.parent.children.length - 1;\n                if (cur_index < last_index) {\n                    selectNode(nodeStatus.cur_node_info.parent.children[cur_index + 1].id);\n                }\n                break;\n            }\n            default:\n                break;\n        }\n    };\n\n    return event => {\n        if (nodeStatus.cur_edit === '') {\n            const is_on_mac = navigator.platform.toUpperCase().startsWith('MAC');\n            const combine_key_pressed = is_on_mac ? event.metaKey : event.ctrlKey;\n            if (combine_key_pressed && event.key.toUpperCase() === 'Z') {\n                if (event.shiftKey) {\n                    historyHook.redoHistory();\n                } else {\n                    historyHook.undoHistory();\n                }\n            }\n        }\n        if (nodeStatus.cur_select !== '') {\n            try {\n                handleKeyEventWithNode(event); // 据说在 try 代码块中写大量语句会影响性能，因此包装为函数\n            } catch (e) {\n                alert('当前的节点信息存在问题，请重新选择节点');\n            }\n        }\n    };\n};"]},"metadata":{},"sourceType":"module"}