{"ast":null,"code":"var _jsxFileName = \"/Users/liuhongyang/Documents/GitHub/repositories/mindmap/src/components/Node/index.js\";\nimport React, { useEffect, useRef, useContext } from 'react';\nimport { css, cx } from 'emotion';\nimport { context } from '../../context';\nimport useMindmap from \"../../customHooks/useMindmap\";\nimport { getNodeInfo } from '../../context/reducer/nodeStatus/actionCreator';\nimport * as refer from '../../statics/refer';\nimport { handlePropagation } from '../../methods/assistFunctions';\nimport Toolbar from './subComponents/Toolbar';\nimport InputDiv from './subComponents/InputDiv';\nimport MdPreview from '../mdPreview';\n\nconst Node = ({\n  layer,\n  node,\n  parent,\n  node_refs,\n  on_left\n}) => {\n  const self = useRef();\n  const {\n    nodeStatus: {\n      state: nodeStatus,\n      dispatch: nDispatch\n    },\n    editPanel: {\n      state: epState\n    }\n  } = useContext(context);\n  const mindmapHook = useMindmap();\n\n  const handleSelectNode = () => {\n    mindmapHook.selectNode(node.id, true);\n  };\n\n  const handleEditNode = () => {\n    mindmapHook.editNode(node.id);\n  };\n\n  const handleToggleChildren = () => {\n    mindmapHook.toggleChildren(node.id, !node.showChildren);\n    mindmapHook.clearNodeStatus(); // 避免出现当前选择的节点被隐藏后仍然可以操作的情况\n  };\n\n  useEffect(() => {\n    node_refs.add(self);\n    return () => {\n      node_refs.delete(self);\n    };\n  }, []);\n  useEffect(() => {\n    if (nodeStatus.cur_select === node.id) {\n      self.current.scrollIntoView({\n        behavior: 'smooth',\n        block: 'center',\n        inline: 'center'\n      });\n      nDispatch(getNodeInfo(node, parent, on_left));\n    }\n  }, [nodeStatus.cur_select, node]); // 为避免事件冒泡导致干扰，点击事件放在了 dropArea div，最外层 Node div 用于阻止冒泡\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: cx(common_style, specific_style[layer < 3 ? layer : 3], {\n      [seleted_style]: nodeStatus.cur_select === node.id\n    }),\n    draggable: layer > 0 && nodeStatus.cur_edit !== node.id,\n    \"data-tag\": on_left ? refer.LEFT_NODE : refer.RIGHT_NODE,\n    \"data-parent\": parent.id,\n    \"data-show-children\": node.showChildren,\n    id: node.id,\n    ref: self,\n    onClick: handlePropagation,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 46,\n      columnNumber: 13\n    }\n  }, nodeStatus.cur_edit === node.id && /*#__PURE__*/React.createElement(InputDiv, {\n    node_id: node.id,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 9\n    }\n  }, node.text), /*#__PURE__*/React.createElement(\"div\", {\n    className: drop_area,\n    \"data-tag\": refer.DROP_AREA,\n    onClick: handleSelectNode,\n    onDoubleClick: handleEditNode,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 57,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 9\n    }\n  }, node.text, \" \", node.info && /*#__PURE__*/React.createElement(MdPreview, {\n    mdtext: node.info,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 38\n    }\n  })), layer > 0 && node.children.length > 0 && /*#__PURE__*/React.createElement(\"button\", {\n    className: cx(toggle_button, on_left ? button_left : button_right),\n    onClick: handleToggleChildren,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 9\n    }\n  }, node.showChildren ? '-' : '+'), nodeStatus.cur_select === node.id && nodeStatus.select_by_click && !epState.isShow && /*#__PURE__*/React.createElement(Toolbar, {\n    layer: layer,\n    node: node,\n    parent: parent,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 9\n    }\n  }));\n};\n\nexport default Node; // CSS\n\nconst style_selected_border = `\nbox-shadow: 0 0 0 3px #ffffff, 0 0 0 6px var(${refer.THEME_EX}); /* 双层阴影实现选中框 */\n`;\nconst common_style = css`\nposition: relative;\nmin-width: 10px;\nmax-width: 200px;\nmargin: 20px 40px;\npadding: 15px;\nbackground-color: #ffffff;\nborder: 1px solid var(${refer.THEME_MAIN});\nborder-radius: 15px;\ncursor: pointer;\n\np {\nmin-height: 18px; /* 当 p 中没有内容时撑起元素 */\nmargin: 0;\nline-height: 1.5em;\noverflow-wrap: break-word;\n}\n\n&:hover {\n${style_selected_border}\n}\n\n&.ondrag {\nbackground-color: var(${refer.THEME_EX});\np {\ncolor: #ffffff;\n}\n}\n`;\nconst specific_style = [// div&用于提高 CSS 权重\ncss`\ndiv& {\npadding: 15px 20px;\ncolor: #ffffff;\nfont-size: 120%;\nfont-weight: 700;\nbackground-color: var(${refer.THEME_DARK});\nborder:2px solid var(${refer.THEME_EX});\n}\n    `, css`\ndiv& {\nbackground-color: var(${refer.THEME_LIGHT});\n}\n    `, css`\ndiv& {\npadding: 10px 15px;\n}\n    `, css`\ndiv& {\npadding: 0 15px;\nborder: none;\np {\nfont-size: 90%;\n}\n}\n    `];\nconst seleted_style = css`\nz-index: 1; /* 提高 Node 高度，防止被遮挡 */\n${style_selected_border}\n`; // 兼有防止文字被选中的功能\n\nconst drop_area = css`\nposition: absolute;\ntop:0;\nbottom:0;\nleft:0;\nright:0;\n`;\nconst toggle_button = css`\nposition: absolute;\ntop:0;\nbottom: 0;\nwidth: 20px;\nheight: 20px;\nmargin: auto 0;\npadding: 0;\ntext-align: center;\nbackground-color: #ffffff;\nborder: 1px solid #cccccc;\nborder-radius: 50%;\noutline: none;\n`;\nconst button_left = css`\nleft: -15px;\n`;\nconst button_right = css`\nright: -15px;\n`;","map":{"version":3,"sources":["/Users/liuhongyang/Documents/GitHub/repositories/mindmap/src/components/Node/index.js"],"names":["React","useEffect","useRef","useContext","css","cx","context","useMindmap","getNodeInfo","refer","handlePropagation","Toolbar","InputDiv","MdPreview","Node","layer","node","parent","node_refs","on_left","self","nodeStatus","state","dispatch","nDispatch","editPanel","epState","mindmapHook","handleSelectNode","selectNode","id","handleEditNode","editNode","handleToggleChildren","toggleChildren","showChildren","clearNodeStatus","add","delete","cur_select","current","scrollIntoView","behavior","block","inline","common_style","specific_style","seleted_style","cur_edit","LEFT_NODE","RIGHT_NODE","text","drop_area","DROP_AREA","info","children","length","toggle_button","button_left","button_right","select_by_click","isShow","style_selected_border","THEME_EX","THEME_MAIN","THEME_DARK","THEME_LIGHT"],"mappings":"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","sourcesContent":["import React, {useEffect, useRef, useContext} from 'react';\nimport {css, cx} from 'emotion';\nimport {context} from '../../context';\nimport useMindmap from \"../../customHooks/useMindmap\";\nimport {getNodeInfo} from '../../context/reducer/nodeStatus/actionCreator';\nimport * as refer from '../../statics/refer';\nimport {handlePropagation} from '../../methods/assistFunctions';\nimport Toolbar from './subComponents/Toolbar';\nimport InputDiv from './subComponents/InputDiv';\nimport MdPreview from '../mdPreview';\n\nconst Node = ({layer, node, parent, node_refs, on_left}) => {\n    const self = useRef();\n    const {nodeStatus: {state: nodeStatus, dispatch: nDispatch}, editPanel: {state:epState}} = useContext(context);\n    const mindmapHook = useMindmap();\n\n\n    const handleSelectNode = () => {\n        mindmapHook.selectNode(node.id, true);\n    };\n\n    const handleEditNode = () => {\n        mindmapHook.editNode(node.id);\n    };\n\n    const handleToggleChildren = () => {\n        mindmapHook.toggleChildren(node.id, !node.showChildren);\n        mindmapHook.clearNodeStatus(); // 避免出现当前选择的节点被隐藏后仍然可以操作的情况\n    };\n\n    useEffect(() => {\n        node_refs.add(self);\n        return () => {\n            node_refs.delete(self);\n        }\n    }, []);\n\n    useEffect(() => {\n        if (nodeStatus.cur_select === node.id) {\n            self.current.scrollIntoView({behavior: 'smooth', block: 'center', inline: 'center'});\n            nDispatch(getNodeInfo(node, parent, on_left));\n        }\n    }, [nodeStatus.cur_select, node]);    \n\n    // 为避免事件冒泡导致干扰，点击事件放在了 dropArea div，最外层 Node div 用于阻止冒泡\n    return (<div\n        className={cx(common_style, specific_style[layer < 3 ? layer : 3], {[seleted_style]: nodeStatus.cur_select === node.id})}\n        draggable={layer > 0 && nodeStatus.cur_edit !== node.id}\n        data-tag={on_left ? refer.LEFT_NODE : refer.RIGHT_NODE}\n        data-parent={parent.id}\n        data-show-children={node.showChildren}\n        id={node.id}\n        ref={self}\n        onClick={handlePropagation}>\n        {nodeStatus.cur_edit === node.id &&\n        <InputDiv node_id={node.id}>{node.text}</InputDiv>}\n        <div className={drop_area} data-tag={refer.DROP_AREA} onClick={handleSelectNode} onDoubleClick={handleEditNode} />\n        <p>{node.text} {node.info && <MdPreview mdtext={node.info}/>}</p>\n        {(layer > 0 && node.children.length > 0) &&\n        <button className={cx(toggle_button, (on_left ? button_left : button_right))} onClick={handleToggleChildren}>{node.showChildren ? '-' : '+'}</button>}\n        {(nodeStatus.cur_select === node.id && nodeStatus.select_by_click) && !epState.isShow &&\n        <Toolbar layer={layer} node={node} parent={parent} />}\n    </div>);\n};\n\nexport default Node;\n\n// CSS\nconst style_selected_border = `\nbox-shadow: 0 0 0 3px #ffffff, 0 0 0 6px var(${refer.THEME_EX}); /* 双层阴影实现选中框 */\n`;\n\nconst common_style = css`\nposition: relative;\nmin-width: 10px;\nmax-width: 200px;\nmargin: 20px 40px;\npadding: 15px;\nbackground-color: #ffffff;\nborder: 1px solid var(${refer.THEME_MAIN});\nborder-radius: 15px;\ncursor: pointer;\n\np {\nmin-height: 18px; /* 当 p 中没有内容时撑起元素 */\nmargin: 0;\nline-height: 1.5em;\noverflow-wrap: break-word;\n}\n\n&:hover {\n${style_selected_border}\n}\n\n&.ondrag {\nbackground-color: var(${refer.THEME_EX});\np {\ncolor: #ffffff;\n}\n}\n`;\n\nconst specific_style = [ // div&用于提高 CSS 权重\n    css`\ndiv& {\npadding: 15px 20px;\ncolor: #ffffff;\nfont-size: 120%;\nfont-weight: 700;\nbackground-color: var(${refer.THEME_DARK});\nborder:2px solid var(${refer.THEME_EX});\n}\n    `,\n    css`\ndiv& {\nbackground-color: var(${refer.THEME_LIGHT});\n}\n    `,\n    css`\ndiv& {\npadding: 10px 15px;\n}\n    `,\n    css`\ndiv& {\npadding: 0 15px;\nborder: none;\np {\nfont-size: 90%;\n}\n}\n    `\n];\n\nconst seleted_style = css`\nz-index: 1; /* 提高 Node 高度，防止被遮挡 */\n${style_selected_border}\n`;\n\n// 兼有防止文字被选中的功能\nconst drop_area = css`\nposition: absolute;\ntop:0;\nbottom:0;\nleft:0;\nright:0;\n`;\n\nconst toggle_button = css`\nposition: absolute;\ntop:0;\nbottom: 0;\nwidth: 20px;\nheight: 20px;\nmargin: auto 0;\npadding: 0;\ntext-align: center;\nbackground-color: #ffffff;\nborder: 1px solid #cccccc;\nborder-radius: 50%;\noutline: none;\n`;\n\nconst button_left = css`\nleft: -15px;\n`;\n\nconst button_right = css`\nright: -15px;\n`;"]},"metadata":{},"sourceType":"module"}