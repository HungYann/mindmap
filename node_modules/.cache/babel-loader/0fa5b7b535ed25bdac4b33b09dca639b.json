{"ast":null,"code":"var _jsxFileName = \"/Users/liuhongyang/Documents/GitHub/repositories/mindmap/src/components/DragCanvas/index.js\";\nimport React, { useState, useEffect, useRef, useContext } from 'react';\nimport { css } from 'emotion';\nimport useMindmap from '../../customHooks/useMindmap';\nimport useTheme from '../../customHooks/useTheme';\nimport getDragEvents from '../../methods/getDragEvents';\nimport { context } from '../../context';\nimport * as refer from '../../statics/refer';\n\nconst DragCanvas = ({\n  parent_ref,\n  container_ref,\n  mindmap\n}) => {\n  const self = useRef();\n  const [flag, setFlag] = useState(0);\n  const {\n    theme\n  } = useTheme();\n  const mindmapHook = useMindmap();\n  const {\n    global: {\n      state: gState\n    }\n  } = useContext(context);\n  const {\n    zoom,\n    x,\n    y\n  } = gState;\n\n  const handleWindowResize = () => {\n    setFlag(Date.now());\n  };\n\n  useEffect(() => {\n    window.addEventListener('resize', handleWindowResize);\n    return () => {\n      window.removeEventListener('resize', handleWindowResize);\n    };\n  }, []);\n  useEffect(() => {\n    const handleDrag = getDragEvents(mindmap, self.current, container_ref.current, theme, mindmapHook, zoom, {\n      x,\n      y\n    });\n    handleDrag.forEach(event => document.querySelector(`#${refer.MINDMAP_ID}`).addEventListener(event.type, event.listener));\n    return () => {\n      handleDrag.forEach(event => document.querySelector(`#${refer.MINDMAP_ID}`).removeEventListener(event.type, event.listener));\n    };\n  }, [mindmap, theme, zoom, x, y]);\n  useEffect(() => {\n    const dom = self.current;\n    dom.width = parent_ref.current.offsetWidth;\n    dom.height = parent_ref.current.offsetHeight;\n  }, [mindmap, flag, gState.zoom]);\n  return /*#__PURE__*/React.createElement(\"canvas\", {\n    ref: self,\n    className: wrapper,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 45,\n      columnNumber: 13\n    }\n  });\n};\n\nexport default DragCanvas; // CSS\n\nconst wrapper = css`\nposition: absolute;\ntop:0;\nleft:0;\nz-index: -1;\n`;","map":{"version":3,"sources":["/Users/liuhongyang/Documents/GitHub/repositories/mindmap/src/components/DragCanvas/index.js"],"names":["React","useState","useEffect","useRef","useContext","css","useMindmap","useTheme","getDragEvents","context","refer","DragCanvas","parent_ref","container_ref","mindmap","self","flag","setFlag","theme","mindmapHook","global","state","gState","zoom","x","y","handleWindowResize","Date","now","window","addEventListener","removeEventListener","handleDrag","current","forEach","event","document","querySelector","MINDMAP_ID","type","listener","dom","width","offsetWidth","height","offsetHeight","wrapper"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef, useContext } from 'react';\nimport { css } from 'emotion';\nimport useMindmap from '../../customHooks/useMindmap';\nimport useTheme from '../../customHooks/useTheme';\nimport getDragEvents from '../../methods/getDragEvents';\nimport { context } from '../../context'\nimport * as refer from '../../statics/refer';\n\nconst DragCanvas = ({ parent_ref, container_ref, mindmap }) => {\n    const self = useRef();\n    const [flag, setFlag] = useState(0);\n\n    const { theme } = useTheme();\n\n    const mindmapHook = useMindmap();\n\n    const { global: { state: gState } } = useContext(context);\n    const {zoom,x,y}=gState\n\n    const handleWindowResize = () => {\n        setFlag(Date.now());\n    };\n\n    useEffect(() => {\n        window.addEventListener('resize', handleWindowResize);\n        return () => {\n            window.removeEventListener('resize', handleWindowResize);\n        }\n    }, []);\n\n    useEffect(() => {\n        const handleDrag = getDragEvents(mindmap, self.current, container_ref.current, theme, mindmapHook,zoom,{x,y});\n        handleDrag.forEach(event => document.querySelector(`#${refer.MINDMAP_ID}`).addEventListener(event.type, event.listener));\n        return () => {\n            handleDrag.forEach(event => document.querySelector(`#${refer.MINDMAP_ID}`).removeEventListener(event.type, event.listener));\n        }\n    }, [mindmap, theme,zoom,x,y]);\n\n    useEffect(() => {\n        const dom = self.current;\n        dom.width = parent_ref.current.offsetWidth;\n        dom.height = parent_ref.current.offsetHeight;\n    }, [mindmap, flag, gState.zoom]);\n\n    return (<canvas ref={self} className={wrapper} />);\n};\n\nexport default DragCanvas;\n\n// CSS\nconst wrapper = css`\nposition: absolute;\ntop:0;\nleft:0;\nz-index: -1;\n`;"]},"metadata":{},"sourceType":"module"}