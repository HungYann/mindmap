{"ast":null,"code":"import _taggedTemplateLiteral from\"/Users/liuhongyang/Documents/GitHub/repositories/mindmap/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";import _defineProperty from\"/Users/liuhongyang/Documents/GitHub/repositories/mindmap/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";function _templateObject10(){var data=_taggedTemplateLiteral([\"\\nright: -15px;\\n\"]);_templateObject10=function _templateObject10(){return data;};return data;}function _templateObject9(){var data=_taggedTemplateLiteral([\"\\nleft: -15px;\\n\"]);_templateObject9=function _templateObject9(){return data;};return data;}function _templateObject8(){var data=_taggedTemplateLiteral([\"\\nposition: absolute;\\ntop:0;\\nbottom: 0;\\nwidth: 20px;\\nheight: 20px;\\nmargin: auto 0;\\npadding: 0;\\ntext-align: center;\\nbackground-color: #ffffff;\\nborder: 1px solid #cccccc;\\nborder-radius: 50%;\\noutline: none;\\n\"]);_templateObject8=function _templateObject8(){return data;};return data;}function _templateObject7(){var data=_taggedTemplateLiteral([\"\\nposition: absolute;\\ntop:0;\\nbottom:0;\\nleft:0;\\nright:0;\\n\"]);_templateObject7=function _templateObject7(){return data;};return data;}function _templateObject6(){var data=_taggedTemplateLiteral([\"\\nz-index: 1; /* \\u63D0\\u9AD8 Node \\u9AD8\\u5EA6\\uFF0C\\u9632\\u6B62\\u88AB\\u906E\\u6321 */\\n\",\"\\n\"]);_templateObject6=function _templateObject6(){return data;};return data;}function _templateObject5(){var data=_taggedTemplateLiteral([\"\\ndiv& {\\npadding: 0 15px;\\nborder: none;\\np {\\nfont-size: 90%;\\n}\\n}\\n    \"]);_templateObject5=function _templateObject5(){return data;};return data;}function _templateObject4(){var data=_taggedTemplateLiteral([\"\\ndiv& {\\npadding: 10px 15px;\\n}\\n    \"]);_templateObject4=function _templateObject4(){return data;};return data;}function _templateObject3(){var data=_taggedTemplateLiteral([\"\\ndiv& {\\nbackground-color: var(\",\");\\n}\\n    \"]);_templateObject3=function _templateObject3(){return data;};return data;}function _templateObject2(){var data=_taggedTemplateLiteral([\"\\ndiv& {\\npadding: 15px 20px;\\ncolor: #ffffff;\\nfont-size: 120%;\\nfont-weight: 700;\\nbackground-color: var(\",\");\\nborder:2px solid var(\",\");\\n}\\n    \"]);_templateObject2=function _templateObject2(){return data;};return data;}function _templateObject(){var data=_taggedTemplateLiteral([\"\\nposition: relative;\\nmin-width: 10px;\\nmax-width: 200px;\\nmargin: 20px 40px;\\npadding: 15px;\\nbackground-color: #ffffff;\\nborder: 1px solid var(\",\");\\nborder-radius: 15px;\\ncursor: pointer;\\n\\np {\\nmin-height: 18px; /* \\u5F53 p \\u4E2D\\u6CA1\\u6709\\u5185\\u5BB9\\u65F6\\u6491\\u8D77\\u5143\\u7D20 */\\nmargin: 0;\\nline-height: 1.5em;\\noverflow-wrap: break-word;\\n}\\n\\n&:hover {\\n\",\"\\n}\\n\\n&.ondrag {\\nbackground-color: var(\",\");\\np {\\ncolor: #ffffff;\\n}\\n}\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useEffect,useRef,useContext}from'react';import{css,cx}from'emotion';import{context}from'../../context';import useMindmap from\"../../customHooks/useMindmap\";import{getNodeInfo}from'../../context/reducer/nodeStatus/actionCreator';import*as refer from'../../statics/refer';import{handlePropagation}from'../../methods/assistFunctions';import Toolbar from'./subComponents/Toolbar';import InputDiv from'./subComponents/InputDiv';import MdPreview from'../mdPreview';var Node=function Node(_ref){var layer=_ref.layer,node=_ref.node,parent=_ref.parent,node_refs=_ref.node_refs,on_left=_ref.on_left;var self=useRef();var _useContext=useContext(context),_useContext$nodeStatu=_useContext.nodeStatus,nodeStatus=_useContext$nodeStatu.state,nDispatch=_useContext$nodeStatu.dispatch,epState=_useContext.editPanel.state;var mindmapHook=useMindmap();var handleSelectNode=function handleSelectNode(){mindmapHook.selectNode(node.id,true);};var handleEditNode=function handleEditNode(){mindmapHook.editNode(node.id);};var handleToggleChildren=function handleToggleChildren(){mindmapHook.toggleChildren(node.id,!node.showChildren);mindmapHook.clearNodeStatus();// 避免出现当前选择的节点被隐藏后仍然可以操作的情况\n};useEffect(function(){node_refs.add(self);return function(){node_refs.delete(self);};},[]);useEffect(function(){if(nodeStatus.cur_select===node.id){self.current.scrollIntoView({behavior:'smooth',block:'center',inline:'center'});nDispatch(getNodeInfo(node,parent,on_left));}},[nodeStatus.cur_select,node]);// 为避免事件冒泡导致干扰，点击事件放在了 dropArea div，最外层 Node div 用于阻止冒泡\nreturn/*#__PURE__*/React.createElement(\"div\",{className:cx(common_style,specific_style[layer<3?layer:3],_defineProperty({},seleted_style,nodeStatus.cur_select===node.id)),draggable:layer>0&&nodeStatus.cur_edit!==node.id,\"data-tag\":on_left?refer.LEFT_NODE:refer.RIGHT_NODE,\"data-parent\":parent.id,\"data-show-children\":node.showChildren,id:node.id,ref:self,onClick:handlePropagation},nodeStatus.cur_edit===node.id&&/*#__PURE__*/React.createElement(InputDiv,{node_id:node.id},node.text),/*#__PURE__*/React.createElement(\"div\",{className:drop_area,\"data-tag\":refer.DROP_AREA,onClick:handleSelectNode,onDoubleClick:handleEditNode}),/*#__PURE__*/React.createElement(\"p\",null,node.text,\" \",node.info&&/*#__PURE__*/React.createElement(MdPreview,{mdtext:node.info})),layer>0&&node.children.length>0&&/*#__PURE__*/React.createElement(\"button\",{className:cx(toggle_button,on_left?button_left:button_right),onClick:handleToggleChildren},node.showChildren?'-':'+'),nodeStatus.cur_select===node.id&&nodeStatus.select_by_click&&!epState.isShow&&/*#__PURE__*/React.createElement(Toolbar,{layer:layer,node:node,parent:parent}));};export default Node;// CSS\nvar style_selected_border=\"\\nbox-shadow: 0 0 0 3px #ffffff, 0 0 0 6px var(\".concat(refer.THEME_EX,\"); /* \\u53CC\\u5C42\\u9634\\u5F71\\u5B9E\\u73B0\\u9009\\u4E2D\\u6846 */\\n\");var common_style=css(_templateObject(),refer.THEME_MAIN,style_selected_border,refer.THEME_EX);var specific_style=[// div&用于提高 CSS 权重\ncss(_templateObject2(),refer.THEME_DARK,refer.THEME_EX),css(_templateObject3(),refer.THEME_LIGHT),css(_templateObject4()),css(_templateObject5())];var seleted_style=css(_templateObject6(),style_selected_border);// 兼有防止文字被选中的功能\nvar drop_area=css(_templateObject7());var toggle_button=css(_templateObject8());var button_left=css(_templateObject9());var button_right=css(_templateObject10());","map":{"version":3,"sources":["/Users/liuhongyang/Documents/GitHub/repositories/mindmap/src/components/Node/index.js"],"names":["React","useEffect","useRef","useContext","css","cx","context","useMindmap","getNodeInfo","refer","handlePropagation","Toolbar","InputDiv","MdPreview","Node","layer","node","parent","node_refs","on_left","self","nodeStatus","state","nDispatch","dispatch","epState","editPanel","mindmapHook","handleSelectNode","selectNode","id","handleEditNode","editNode","handleToggleChildren","toggleChildren","showChildren","clearNodeStatus","add","delete","cur_select","current","scrollIntoView","behavior","block","inline","common_style","specific_style","seleted_style","cur_edit","LEFT_NODE","RIGHT_NODE","text","drop_area","DROP_AREA","info","children","length","toggle_button","button_left","button_right","select_by_click","isShow","style_selected_border","THEME_EX","THEME_MAIN","THEME_DARK","THEME_LIGHT"],"mappings":"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","sourcesContent":["import React, {useEffect, useRef, useContext} from 'react';\nimport {css, cx} from 'emotion';\nimport {context} from '../../context';\nimport useMindmap from \"../../customHooks/useMindmap\";\nimport {getNodeInfo} from '../../context/reducer/nodeStatus/actionCreator';\nimport * as refer from '../../statics/refer';\nimport {handlePropagation} from '../../methods/assistFunctions';\nimport Toolbar from './subComponents/Toolbar';\nimport InputDiv from './subComponents/InputDiv';\nimport MdPreview from '../mdPreview';\n\nconst Node = ({layer, node, parent, node_refs, on_left}) => {\n    const self = useRef();\n    const {nodeStatus: {state: nodeStatus, dispatch: nDispatch}, editPanel: {state:epState}} = useContext(context);\n    const mindmapHook = useMindmap();\n\n\n    const handleSelectNode = () => {\n        mindmapHook.selectNode(node.id, true);\n    };\n\n    const handleEditNode = () => {\n        mindmapHook.editNode(node.id);\n    };\n\n    const handleToggleChildren = () => {\n        mindmapHook.toggleChildren(node.id, !node.showChildren);\n        mindmapHook.clearNodeStatus(); // 避免出现当前选择的节点被隐藏后仍然可以操作的情况\n    };\n\n    useEffect(() => {\n        node_refs.add(self);\n        return () => {\n            node_refs.delete(self);\n        }\n    }, []);\n\n    useEffect(() => {\n        if (nodeStatus.cur_select === node.id) {\n            self.current.scrollIntoView({behavior: 'smooth', block: 'center', inline: 'center'});\n            nDispatch(getNodeInfo(node, parent, on_left));\n        }\n    }, [nodeStatus.cur_select, node]);    \n\n    // 为避免事件冒泡导致干扰，点击事件放在了 dropArea div，最外层 Node div 用于阻止冒泡\n    return (<div\n        className={cx(common_style, specific_style[layer < 3 ? layer : 3], {[seleted_style]: nodeStatus.cur_select === node.id})}\n        draggable={layer > 0 && nodeStatus.cur_edit !== node.id}\n        data-tag={on_left ? refer.LEFT_NODE : refer.RIGHT_NODE}\n        data-parent={parent.id}\n        data-show-children={node.showChildren}\n        id={node.id}\n        ref={self}\n        onClick={handlePropagation}>\n        {nodeStatus.cur_edit === node.id &&\n        <InputDiv node_id={node.id}>{node.text}</InputDiv>}\n        <div className={drop_area} data-tag={refer.DROP_AREA} onClick={handleSelectNode} onDoubleClick={handleEditNode} />\n        <p>{node.text} {node.info && <MdPreview mdtext={node.info}/>}</p>\n        {(layer > 0 && node.children.length > 0) &&\n        <button className={cx(toggle_button, (on_left ? button_left : button_right))} onClick={handleToggleChildren}>{node.showChildren ? '-' : '+'}</button>}\n        {(nodeStatus.cur_select === node.id && nodeStatus.select_by_click) && !epState.isShow &&\n        <Toolbar layer={layer} node={node} parent={parent} />}\n    </div>);\n};\n\nexport default Node;\n\n// CSS\nconst style_selected_border = `\nbox-shadow: 0 0 0 3px #ffffff, 0 0 0 6px var(${refer.THEME_EX}); /* 双层阴影实现选中框 */\n`;\n\nconst common_style = css`\nposition: relative;\nmin-width: 10px;\nmax-width: 200px;\nmargin: 20px 40px;\npadding: 15px;\nbackground-color: #ffffff;\nborder: 1px solid var(${refer.THEME_MAIN});\nborder-radius: 15px;\ncursor: pointer;\n\np {\nmin-height: 18px; /* 当 p 中没有内容时撑起元素 */\nmargin: 0;\nline-height: 1.5em;\noverflow-wrap: break-word;\n}\n\n&:hover {\n${style_selected_border}\n}\n\n&.ondrag {\nbackground-color: var(${refer.THEME_EX});\np {\ncolor: #ffffff;\n}\n}\n`;\n\nconst specific_style = [ // div&用于提高 CSS 权重\n    css`\ndiv& {\npadding: 15px 20px;\ncolor: #ffffff;\nfont-size: 120%;\nfont-weight: 700;\nbackground-color: var(${refer.THEME_DARK});\nborder:2px solid var(${refer.THEME_EX});\n}\n    `,\n    css`\ndiv& {\nbackground-color: var(${refer.THEME_LIGHT});\n}\n    `,\n    css`\ndiv& {\npadding: 10px 15px;\n}\n    `,\n    css`\ndiv& {\npadding: 0 15px;\nborder: none;\np {\nfont-size: 90%;\n}\n}\n    `\n];\n\nconst seleted_style = css`\nz-index: 1; /* 提高 Node 高度，防止被遮挡 */\n${style_selected_border}\n`;\n\n// 兼有防止文字被选中的功能\nconst drop_area = css`\nposition: absolute;\ntop:0;\nbottom:0;\nleft:0;\nright:0;\n`;\n\nconst toggle_button = css`\nposition: absolute;\ntop:0;\nbottom: 0;\nwidth: 20px;\nheight: 20px;\nmargin: auto 0;\npadding: 0;\ntext-align: center;\nbackground-color: #ffffff;\nborder: 1px solid #cccccc;\nborder-radius: 50%;\noutline: none;\n`;\n\nconst button_left = css`\nleft: -15px;\n`;\n\nconst button_right = css`\nright: -15px;\n`;"]},"metadata":{},"sourceType":"module"}